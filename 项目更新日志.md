2025.10.22 周三
嗯已经有必要写一个项目更新日志的文档了，东西零零碎碎不好整合，还是码字写下来好点；
今天忘记把家里电脑开机了，很多文件没法处理，于是在看文献；
前期已经准备好了翼型轮廓图数据集，与现有论文不同的是，我的翼型数据文件根据NACA标准生成的；
由于网站能找到的翼型没有统一格式，即使进行数据清洗，仍然会损失大量数据，于是直接生成1000个；
但是由于是固定了70%概率生成4位数翼型及其对称翼型道高弯度、最大弯度位置以及厚度在合理的范围，30%概率生成5位数翼型，设计升力系数、最大弯度位置、前后弧线类型以及厚度均设定在了合理范围；最后只剩857个可用的翼型文件；

使用翼型数据文件生成了翼型轮廓图；

写了一个python代码批量调用xfoil，设定条件为Re=1e6，Ma=0.15，AOA=[-5，15，1]对翼型进行气动特性分析，得到cl、cd、cl/cd、cm等数据保存为一个csv文件；

对xfoil气动分析数据进行数据质量探索分析，将cl、cd、cl/cd、cm的分布特征进行可视化，绘制了部分cl随AOA变化曲线和极曲线；用主成分分析对翼型性能特征进行降维处理以识别翼型聚类模式，图中数据点的分布清晰地揭示了两个关键信息：第一，存在一个密集的核心集群，代表了绝大多数性能相似、遵循常规设计权衡的“主流”翼型；第二，少数远离中心的离群点，则代表了性能独特或极端的“特殊”翼型；

然后进行模型架构设计，选择了U-Net作为主干网络，因为它具有编码器-解码器结构，非常适合图像生成任务，能够有效捕获多尺度特征。
在U-Net的基础上加入了注意力机制，特别是在深层特征图中使用自注意力，这样可以让模型更好地关注翼型的关键几何特征，比如前缘、后缘和最大厚度位置。
对于条件信息处理，设计了一个多层感知机来编码气动性能参数（CL、CD、CL/CD），并将其通过条件调制机制融入到每个残差块中，让模型在生成过程中始终受到目标条件的约束。
还实现了时间嵌入模块，使用正弦位置编码来处理扩散过程中的时间步信息。为了提升生成质量，采用了EMA（指数移动平均）技术来维护一个更稳定的模型副本用于推理。
整个架构的核心思想是让模型能够同时理解翼型的几何结构和气动性能之间的复杂关系，通过条件引导生成符合特定性能要求的翼型设计。

训练这个条件扩散模型其实挺有挑战性的，主要用了几个关键技巧。
首先是数据预处理，把翼型图像归一化到-1到1的范围，这是扩散模型的标准做法，能让训练更稳定。
条件参数也用StandardScaler做了标准化，避免不同量级的参数影响模型学习。
训练时用了余弦退火学习率调度，开始用较大学习率快速收敛，后面逐渐降低避免震荡。
梯度累积也很重要，因为GPU内存有限，用小的batch size但累积多次梯度更新，相当于增大了有效batch size。
最关键的还是损失函数设计，除了基本的MSE损失，还加了边缘损失，用Sobel算子计算图像梯度，让模型生成的翼型轮廓更清晰。
EMA模型是另一个重要技巧，维护一个指数移动平均的模型副本，训练时用原始模型，生成时用EMA模型，这样生成的图像质量更好更稳定。
混合精度训练也用了，用FP16加速训练同时节省显存。整个训练过程200个epoch，每个epoch都会生成一些样本看看效果，及时发现问题调整参数。

生成翼型图像过程其实挺有意思的，用的是DDIM采样算法，比现有论文里传统的DDPM快很多。
首先要把目标条件标准化，比如想要CL=0.8、CD=0.012的翼型，就按照训练时的scaler把这两个值标准化。
然后从纯噪声开始，就是一张完全随机的噪声图像。
DDIM的核心思想是跳过很多中间步骤，直接从1000步压缩到50步，大大提升生成速度。每一步都是先让模型预测噪声，然后根据DDIM的更新公式计算下一步的图像。
这个过程有点像"去噪"，从完全随机的噪声一步步变成清晰的翼型轮廓。
生成过程中条件信息一直参与其中，确保最终生成的翼型符合目标性能要求。
最后把生成的图像从-1到1的范围转换回0到255的像素值，保存成PNG格式。
整个过程大概不到1秒就能生成一张翼型，而且质量很好，轮廓清晰，几何形状合理。
终于也是能成功生成了，回去奖励自己吃点水果:)

